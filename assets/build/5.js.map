{"version":3,"sources":["../../../ionicgame/src/pages/game/game.module.ts","../../../ionicgame/src/pages/game/game.ts"],"names":[],"mappings":"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","file":"5.js","sourcesContent":["import { NgModule } from \"@angular/core\"\nimport { IonicPageModule } from \"ionic-angular\"\nimport { GamePage } from \"./game\"\nimport { NgxPaginationModule } from \"ngx-pagination\" // <-- import the module\nimport { ComponentsModule } from \"../../components/components.module\"\n\n@NgModule({\n  declarations: [GamePage],\n  imports: [\n    NgxPaginationModule,\n    ComponentsModule,\n    IonicPageModule.forChild(GamePage)\n  ]\n})\nexport class GamePageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/game/game.module.ts","import { Component, ViewChild } from \"@angular/core\"\nimport {\n  IonicPage,\n  NavController,\n  NavParams,\n  MenuController,\n  Events,\n  Content\n} from \"ionic-angular\"\nimport { DomSanitizer } from \"@angular/platform-browser\"\nimport { AppState } from \"../../app/app.service\"\ndeclare var io: any\n\n@IonicPage()\n@Component({\n  selector: \"page-game\",\n  templateUrl: \"game.html\"\n})\nexport class GamePage {\n  gameLoaded = false\n  msgs = []\n  msg: string\n  noAccount = false\n  showChat = false\n  chatConnected = false\n  room\n  listening: any\n  loadingStyle = this.sanitizer.bypassSecurityTrustStyle(\"inset(0 100% 0 0)\")\n  selectLoad = false\n  showSelect = false\n  ships\n\n  @ViewChild(\"chatcontent\") chatcontent\n  @ViewChild(Content) content: Content\n\n  constructor(\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    public appState: AppState,\n    public menuCtrl: MenuController,\n    public events: Events,\n    private sanitizer: DomSanitizer\n  ) {\n    // io.socket.on(\"chatmessage\", msg => {\n    //   this.msgs.push(msg.data)\n    // })\n    this.getShips()\n  }\n\n  getShips() {\n    this.selectLoad = true\n    console.log(\"getting io\")\n    io.socket.get(\n      \"/api/v1/ships?address=\" + encodeURI(this.appState.account),\n      {},\n      data => {\n        console.log(data)\n        this.selectLoad = false\n        if (data.length > 0) {\n          // data.forEach(ship => {\n          //   ship[\"img\"] = \"randomColo\" + Math.floor(Math.random() * 4.99) + \".png\"\n          // })\n          this.ships = data\n        }\n      }\n    )\n  }\n\n  shipSelect() {\n    // return window[\"ShowSelect\"]\n  }\n\n  mouseVisible() {\n    return !document.pointerLockElement\n  }\n\n  ionViewDidLoad() {\n    console.log(\"ionViewDidLoad GamePage\")\n\n    this.loadGame()\n    this.events.subscribe(\"account:changed\", account => {\n      setTimeout(() => {\n        this.loadGame()\n      }, 0)\n    })\n  }\n\n  // public loadingStyle() {\n  //   return this.sanitizer.bypassSecurityTrustStyle(\"inset(0 74% 0 0)\")\n  // }\n\n  leaveRoom() {\n    io.socket.post(\"/api/v1/chat/leave\", { room: this.room }, () => {\n      this.room = null\n      this.chatConnected = false\n    })\n  }\n\n  joinRoom(room: string) {\n    console.log(\"join room000\")\n    io.socket.post(\"/api/v1/chat/join\", { room: room }, () => {\n      console.log(\"joined room \" + room)\n      this.room = room\n      this.chatConnected = true\n      this.msgs.push({\n        text:\n          (this.appState.username || this.appState.account.substring(0, 5)) +\n          \" connected to chat\"\n      })\n      if (!this.listening) {\n        this.listening = true\n        io.socket.on(\"message\", message => {\n          if (message) {\n            console.log(\"gotmsg\", message)\n            this.msgs.push(message)\n          } else {\n            console.log(\"why\")\n          }\n        })\n      }\n    })\n  }\n\n  ionViewDidEnter() {\n    console.log(this.appState.account)\n    this.chatcontent.scrollToBottom(1000) //300ms animation speed\n    // io.socket.get(\"/api/chatMessage\", body => {\n    //   this.msgs = body\n    // })\n  }\n\n  ionViewWillLeave() {\n    console.log(\"view leaving\")\n    // this.goFull(false)\n  }\n\n  ionViewWillUnload() {\n    console.log(\"view unloaded\")\n  }\n\n  loadGameServices() {\n    window[\"UnityProgress\"] = (gameInstance, progress) => {\n      let calc = 100 - progress * 100\n      if (calc == 0) {\n        this.gameLoaded = true\n        console.log(\"NAME: \" + this.appState.username || this.appState.account)\n        console.log(this.appState.username)\n        window[\"gameInstance\"].SendMessage(\n          \"Web3Init\",\n          \"SetDisplayName\",\n          this.appState.username || this.appState.account.substring(0, 5)\n        )\n      }\n      console.log(\"in ionc=\", progress, calc)\n      this.loadingStyle = this.sanitizer.bypassSecurityTrustStyle(\n        \"inset(0 \" + calc + \"% 0 0)\"\n      )\n    }\n    window.addEventListener(\"room\", (e: any) => {\n      if (e.detail.join) {\n        this.joinRoom(e.detail.room)\n      } else {\n        if (this.room) {\n          this.leaveRoom()\n        }\n      }\n    })\n\n    window.addEventListener(\"show-select\", (e: any) => {\n      this.showSelect = e.detail\n    })\n  }\n\n  loadGame() {\n    // console.log(document.getElementById(\"gameContainer\"))\n    if (this.appState.account && !window[\"gameInstance\"]) {\n      this.loadGameServices()\n      window[\"gameInstance\"] = window[\"UnityLoader\"].instantiate(\n        \"gameContainer\",\n        \"/game/Build/unitywebDemo.json\",\n        { onProgress: window[\"UnityProgress\"] }\n      )\n      let canvas = document.getElementById(\"#canvas\")\n      canvas.tabIndex = 1\n    } else {\n      console.log(\"already loaded\")\n    }\n  }\n\n  send(key) {\n    if (key == 13) {\n      if (this.chatConnected && this.room) {\n        // console.log(\"msg: \", this.msg)\n        let msg = {\n          username:\n            this.appState.username || this.appState.account.substring(0, 5),\n          account: this.appState.account,\n          text: this.msg\n        }\n        // this.msgs.push(msg)\n\n        // io.socket.post(\"/api/chatMessage\", msg, res => {})\n        io.socket.post(\"/api/v1/chat/send\", { data: msg, room: this.room })\n        this.msg = \"\"\n        setTimeout(() => {\n          this.chatcontent.scrollToBottom(300) //300ms animation speed\n        }, 50)\n      } else {\n        this.msg = \"\"\n      }\n    }\n  }\n\n  isFullscreen = false\n  goFull(shouldRevert = true) {\n    let canvaswindow = document.getElementById(\"canvaswindow\")\n    let canvasfull = document.getElementById(\"canvasfull\")\n    while (canvaswindow.childNodes.length > 0) {\n      canvasfull.appendChild(canvaswindow.childNodes[0])\n    }\n    // document.getElementsByName(\"canvas\")[0].webkitRequestFullScreen()\n    window[\"gameInstance\"].SetFullscreen(1)\n    if (shouldRevert) {\n      this.isFullscreen = true\n      let inter = setInterval(() => {\n        console.log(1 >= outerHeight - innerHeight)\n        if (1 < outerHeight - innerHeight) {\n          while (canvasfull.childNodes.length > 0) {\n            canvaswindow.appendChild(canvasfull.childNodes[0])\n          }\n          clearInterval(inter)\n        }\n      }, 100)\n    }\n  }\n\n  toggleChat() {\n    this.showChat = !this.showChat\n\n    this.content.resize()\n    // if (this.msgs.length > 0) {\n    //   setTimeout(() => {\n    //     let m = this.msgs.pop() //hack to fix chat width\n    //     setTimeout(() => {\n    //       this.msgs.push(m)\n    //     }, 0)\n    //   }, 20)\n    // } else {\n    //   // setTimeout(() => {\n    //   //   this.msgs.push({ username: \"\", text: \"\" }) //hack to fix chat width\n    //   //   setTimeout(() => {\n    //   //     this.msgs.pop()\n    //   //   }, 0)\n    //   // }, 20)\n    // }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/game/game.ts"],"sourceRoot":""}